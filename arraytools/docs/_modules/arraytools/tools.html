

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>arraytools.tools &mdash; arraytools 0.9 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> arraytools
          

          
          </a>

          
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">arraytools... :</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arraytools_mods.html">Modules in arraytools</a></li>
</ul>
<p class="caption"><span class="caption-text">Sphinx...:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Sphinx_documentation.html">How to document Sphinx</a></li>
</ul>
<p class="caption"><span class="caption-text">ReStructuredText...:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../md_tester.html">Documentation tips</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">arraytools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>arraytools.tools</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for arraytools.tools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: UTF-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">=====</span>
<span class="sd">tools</span>
<span class="sd">=====</span>

<span class="sd">Script :   tools.py</span>

<span class="sd">Author :   Dan_Patterson@carleton.ca</span>

<span class="sd">Modified : 2019-01-06</span>

<span class="sd">Purpose :  tools for working with numpy arrays</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#Useage</span>
<span class="c1">#------</span>

<span class="c1">#import arraytools as art</span>
<span class="c1">#</span>
<span class="c1">#`tools.py` and other scripts are part of the arraytools package.</span>
<span class="c1">#Access in other programs using .... art.func(params) ....</span>
<span class="c1">#</span>
<span class="c1">#Requires</span>
<span class="c1">#--------</span>
<span class="c1">#see import section and __init__.py in the `arraytools` folder</span>
<span class="c1">#</span>
<span class="c1">#Notes</span>
<span class="c1">#-----</span>
<span class="c1">#Basic array information::</span>
<span class="c1">#</span>
<span class="c1">#    np.typecodes, np.sctypeDict, np.sctypes</span>
<span class="c1">#</span>
<span class="c1">#    &gt;&gt;&gt; for i in np.sctypes:</span>
<span class="c1">#           print(&quot;{!s:&lt;8} : {}&quot;.format(i, np.sctypes[i]))</span>
<span class="c1">#</span>
<span class="c1">#Classes available::</span>
<span class="c1">#</span>
<span class="c1">#    int : class</span>
<span class="c1">#        &#39;numpy.int8&#39;, &#39;numpy.int16&#39;, &#39;numpy.int32&#39;, &#39;numpy.int64&#39;</span>
<span class="c1">#    uint : class</span>
<span class="c1">#        &#39;numpy.uint8&#39;, &#39;numpy.uint16&#39;, &#39;numpy.uint32, &#39;numpy.uint64&#39;</span>
<span class="c1">#    float : class</span>
<span class="c1">#        &#39;numpy.float16&#39;, &#39;numpy.float32&#39;, &#39;numpy.float64&#39;</span>
<span class="c1">#    complex : class</span>
<span class="c1">#        &#39;numpy.complex64&#39;, &#39;numpy.complex128&#39;</span>
<span class="c1">#    others : class</span>
<span class="c1">#        &#39;bool&#39;, &#39;object&#39;, &#39;bytes&#39;, &#39;str&#39;, &#39;numpy.void&#39;</span>
<span class="c1">#</span>
<span class="c1">#Typecodes::</span>
<span class="c1">#</span>
<span class="c1">#    `np.typecodes.items()`  ... `np.typecodes[&#39;AllInteger&#39;]`::</span>
<span class="c1">#    #</span>
<span class="c1">#    All: &#39;?bhilqpBHILQPefdgFDGSUVOMm&#39;</span>
<span class="c1">#    |__AllFloat: &#39;efdgFDG&#39;</span>
<span class="c1">#       |__Float: &#39;efdg&#39;</span>
<span class="c1">#       |__Complex: &#39;FDG&#39;</span>
<span class="c1">#    |__AllInteger: &#39;bBhHiIlLqQpP&#39;</span>
<span class="c1">#    |  |__UnsignedInteger: &#39;BHILQP&#39;</span>
<span class="c1">#    |  |__Integer: &#39;bhilqp&#39;</span>
<span class="c1">#    |__Datetime&#39;: &#39;Mm&#39;</span>
<span class="c1">#    |__Character&#39;: &#39;c&#39;</span>
<span class="c1">#    |__Other:  &#39;U&#39;, &#39;?&#39;, &#39;S&#39;, &#39;O&#39;, &#39;V&#39;  Determined from the above</span>
<span class="c1">#    #</span>
<span class="c1">#    `np.sctypes.keys` and `np.sctypes.values`::</span>
<span class="c1">#    #</span>
<span class="c1">#    numpy classes</span>
<span class="c1">#    |__complex  complex64, complex128, complex256</span>
<span class="c1">#    |__float    float16, float32, float64, float128</span>
<span class="c1">#    |__int      int8, int16, int32, int64</span>
<span class="c1">#    |__uint     uint8, uint16, uint32, uint63</span>
<span class="c1">#    |__others   bool, object, str, void</span>
<span class="c1">#                   ?,   O,    S U,  V</span>
<span class="c1">#</span>
<span class="c1">#Numbers::</span>
<span class="c1">#</span>
<span class="c1">#   np.inf, -np.inf</span>
<span class="c1">#   np.iinfo(np.int8).min  or .max = -128, 128</span>
<span class="c1">#   np.iinfo(np.int16).min or .max = -32768, 32768</span>
<span class="c1">#   np.iinfo(np.int32).min or .max = -2147483648, max=2147483647</span>
<span class="c1">#   np.finfo(np.float64)</span>
<span class="c1">#   np.finfo(resolution=1e-15, min=-1.7976931348623157e+308,</span>
<span class="c1">#            max=1.7976931348623157e+308, dtype=float64)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#Functions</span>
<span class="c1">#---------</span>
<span class="c1">#Tool function examples follow...</span>
<span class="c1">#</span>
<span class="c1">#arr2xyz :</span>
<span class="c1">#    convert 2/3D arrays into xyz values (ie 2D)</span>
<span class="c1">#</span>
<span class="c1">#::</span>
<span class="c1">#    arr2xyz(a, verbose=False) : convert an array to x,y,z values, using</span>
<span class="c1">#    row/column values for x and y::</span>
<span class="c1">#</span>
<span class="c1">#        a= np.arange(2*3).reshape(2,3)</span>
<span class="c1">#        arr2xyz(a)</span>
<span class="c1">#        array([[0, 0, 0],</span>
<span class="c1">#               [1, 0, 1],</span>
<span class="c1">#               [2, 0, 2],</span>
<span class="c1">#               [0, 1, 3],</span>
<span class="c1">#               [1, 1, 4],</span>
<span class="c1">#               [2, 1, 5]])</span>
<span class="c1">#</span>
<span class="c1">#make_blocks :</span>
<span class="c1">#    create array blocks</span>
<span class="c1">#</span>
<span class="c1">#    &gt;&gt;&gt; make_blocks(rows=2, cols=4, r=2, c=2, dt=&#39;int&#39;)</span>
<span class="c1">#    array([[0, 0, 1, 1, 2, 2, 3, 3],</span>
<span class="c1">#           [0, 0, 1, 1, 2, 2, 3, 3],</span>
<span class="c1">#           [4, 4, 5, 5, 6, 6, 7, 7],</span>
<span class="c1">#           [4, 4, 5, 5, 6, 6, 7, 7]])</span>
<span class="c1">#</span>
<span class="c1">#group_vals(seq, stepsize=1)::</span>
<span class="c1">#</span>
<span class="c1">#    seq = [1, 2, 4, 5, 8, 9, 10]</span>
<span class="c1">#    stepsize = 1</span>
<span class="c1">#    [array([1, 2]), array([4, 5]), array([ 8,  9, 10])]</span>
<span class="c1">#</span>
<span class="c1">#reclass(z, bins, new_bins, mask=False, mask_val=None)::</span>
<span class="c1">#</span>
<span class="c1">#    Reclass an array using existing class breaks (bins) and new bins both</span>
<span class="c1">#    must be in ascending order</span>
<span class="c1">#</span>
<span class="c1">#    z = np.arange(3*5).reshape(3,5)</span>
<span class="c1">#    bins = [0, 5, 10, 15]</span>
<span class="c1">#    new_bins = [1, 2, 3, 4]</span>
<span class="c1">#    z_recl = reclass(z, bins, new_bins, mask=False, mask_val=None)</span>
<span class="c1">#    ==&gt; .... z                     ==&gt; .... z_recl</span>
<span class="c1">#    array([[ 0,  1,  2,  3,  4],   array([[1, 1, 1, 1, 1],</span>
<span class="c1">#           [ 5,  6,  7,  8,  9],          [2, 2, 2, 2, 2],</span>
<span class="c1">#           [10, 11, 12, 13, 14]])         [3, 3, 3, 3, 3]])</span>
<span class="c1">#</span>
<span class="c1">#scale(a, x=2, y=2) :</span>
<span class="c1">#    scale an array by x, y factors</span>
<span class="c1">#</span>
<span class="c1">#::</span>
<span class="c1">#</span>
<span class="c1">#      a = np.array([[0, 1, 2], [3, 4, 5]]</span>
<span class="c1">#      b = scale(a, x=2, y=2)</span>
<span class="c1">#        =  array([[0, 0, 1, 1, 2, 2],</span>
<span class="c1">#                  [0, 0, 1, 1, 2, 2],</span>
<span class="c1">#                  [3, 3, 4, 4, 5, 5],</span>
<span class="c1">#                  [3, 3, 4, 4, 5, 5]])</span>
<span class="c1">#</span>
<span class="c1">#using scale with np.tile::</span>
<span class="c1">#</span>
<span class="c1">#      art.scale(a, 2,2)         np.tile(art.scale(a, 2, 2), (2, 2))</span>
<span class="c1">#      array([[0, 0, 1, 1],      array([[0, 0, 1, 1, 0, 0, 1, 1],</span>
<span class="c1">#             [0, 0, 1, 1],             [0, 0, 1, 1, 0, 0, 1, 1],</span>
<span class="c1">#             [2, 2, 3, 3],             [2, 2, 3, 3, 2, 2, 3, 3],</span>
<span class="c1">#             [2, 2, 3, 3]])            [2, 2, 3, 3, 2, 2, 3, 3],</span>
<span class="c1">#                                       [0, 0, 1, 1, 0, 0, 1, 1],</span>
<span class="c1">#                                       [0, 0, 1, 1, 0, 0, 1, 1],</span>
<span class="c1">#                                       [2, 2, 3, 3, 2, 2, 3, 3],</span>
<span class="c1">#                                       [2, 2, 3, 3, 2, 2, 3, 3]])</span>
<span class="c1">#</span>
<span class="c1">#split_array(a, fld=&#39;Id&#39;) :</span>
<span class="c1">#    split array by fields</span>
<span class="c1">#</span>
<span class="c1">#::</span>
<span class="c1">#</span>
<span class="c1">#     array &#39;b&#39;</span>
<span class="c1">#     array([(0, 1, 2, 3), (4, 5, 6, 7), (8, 9, 10, 11)],</span>
<span class="c1">#           dtype=[(&#39;A&#39;, &#39;&lt;i4&#39;), (&#39;B&#39;, &#39;&lt;i4&#39;), (&#39;C&#39;, &#39;&lt;i4&#39;), (&#39;D&#39;, &#39;&lt;i4&#39;)])</span>
<span class="c1">#    - split_array(b, fld=&#39;A&#39;)</span>
<span class="c1">#    [array([(0, 1, 2, 3)],</span>
<span class="c1">#          dtype=[(&#39;A&#39;, &#39;&lt;i4&#39;), (&#39;B&#39;, &#39;&lt;i4&#39;), (&#39;C&#39;, &#39;&lt;i4&#39;), (&#39;D&#39;, &#39;&lt;i4&#39;)]),</span>
<span class="c1">#     array([(4, 5, 6, 7)],</span>
<span class="c1">#          dtype=[(&#39;A&#39;, &#39;&lt;i4&#39;), (&#39;B&#39;, &#39;&lt;i4&#39;), (&#39;C&#39;, &#39;&lt;i4&#39;), (&#39;D&#39;, &#39;&lt;i4&#39;)]),</span>
<span class="c1">#     array([(8, 9, 10, 11)],</span>
<span class="c1">#          dtype=[(&#39;A&#39;, &#39;&lt;i4&#39;), (&#39;B&#39;, &#39;&lt;i4&#39;), (&#39;C&#39;, &#39;&lt;i4&#39;), (&#39;D&#39;, &#39;&lt;i4&#39;)])]</span>
<span class="c1">#</span>
<span class="c1">#make_flds(n=1, as_type=names=None, default=&quot;col&quot;) :</span>
<span class="c1">#    example to make fields</span>
<span class="c1">#</span>
<span class="c1">#::</span>
<span class="c1">#    &gt;&gt;&gt; from numpy.lib._iotools import easy_dtype as easy</span>
<span class="c1">#    &gt;&gt;&gt; make_flds(n=1, as_type=&#39;float&#39;, names=None, def_name=&quot;col&quot;)</span>
<span class="c1">#    dtype([(&#39;col_00&#39;, &#39;&lt;f8&#39;)])</span>
<span class="c1">#</span>
<span class="c1">#    &gt;&gt;&gt; make_flds(n=2, as_type=&#39;int&#39;, names=[&#39;f01&#39;, &#39;f02&#39;], def_name=&quot;col&quot;)</span>
<span class="c1">#    dtype([(&#39;f01&#39;, &#39;&lt;i8&#39;), (&#39;f02&#39;, &#39;&lt;i8&#39;)])</span>
<span class="c1">#</span>
<span class="c1">#nd_rec :</span>
<span class="c1">#    ndarray to structured array or recarray</span>
<span class="c1">#</span>
<span class="c1">#nd_struct and nd2struct(a)</span>
<span class="c1">#</span>
<span class="c1">#Keep the dtype the same::</span>
<span class="c1">#</span>
<span class="c1">#    aa = nd2struct(a)       # produce a structured array from inputs</span>
<span class="c1">#    aa.reshape(-1,1)        # structured array</span>
<span class="c1">#    array([[(0, 1, 2, 3, 4)],</span>
<span class="c1">#           [(5, 6, 7, 8, 9)],</span>
<span class="c1">#           [(10, 11, 12, 13, 14)],</span>
<span class="c1">#           [(15, 16, 17, 18, 19)]],</span>
<span class="c1">#       dtype=[(&#39;A&#39;, &#39;&lt;i4&#39;), ... snip ... , (&#39;E&#39;, &#39;&lt;i4&#39;)])</span>
<span class="c1">#</span>
<span class="c1">#Upcast the dtype::</span>
<span class="c1">#</span>
<span class="c1">#    a_f = nd2struct(a.astype(&#39;float&#39;))  # note astype allows a view</span>
<span class="c1">#    array([(0.0, 1.0, 2.0, 3.0, 4.0), ... snip... ,</span>
<span class="c1">#           (15.0, 16.0, 17.0, 18.0, 19.0)],</span>
<span class="c1">#          dtype=[(&#39;A&#39;, &#39;&lt;f8&#39;), ... snip ... , (&#39;E&#39;, &#39;&lt;f8&#39;)])</span>
<span class="c1">#</span>
<span class="c1">#np2rec :</span>
<span class="c1">#    shell around above</span>
<span class="c1">#</span>
<span class="c1">#rc_vals and xy_vals(a) :</span>
<span class="c1">#    array to x, y, values</span>
<span class="c1">#</span>
<span class="c1">#array_cols</span>
<span class="c1">#</span>
<span class="c1">#change_arr(a, order=[], prn=False) :</span>
<span class="c1">#    merely a convenience function</span>
<span class="c1">#</span>
<span class="c1">#::</span>
<span class="c1">#    a = np.arange(4*5).reshape((4, 5))</span>
<span class="c1">#    change(a, [2, 1, 0, 3, 4])</span>
<span class="c1">#    array([[ 2,  1,  0,  3,  4],</span>
<span class="c1">#           [ 7,  6,  5,  8,  9],</span>
<span class="c1">#           [12, 11, 10, 13, 14],</span>
<span class="c1">#           [17, 16, 15, 18, 19]])</span>
<span class="c1">#</span>
<span class="c1">#**shortcuts**</span>
<span class="c1">#</span>
<span class="c1">#::</span>
<span class="c1">#</span>
<span class="c1">#    b = a[:, [2, 1, 0, 3, 4]]    # reorder the columns, keeping the rows</span>
<span class="c1">#    c = a[:, [0, 2, 3]]          # delete columns 1 and 4</span>
<span class="c1">#    d = a[[0, 1, 3, 4], :]       # delete row 2, keeping the columns</span>
<span class="c1">#    e = a[[0, 1, 3], [1, 2, 3]]  # keep [0, 1], [1, 2], [3, 3]</span>
<span class="c1">#                                   =&gt; ([ 1, 7, 18])</span>
<span class="c1">#</span>
<span class="c1">#**16. concat_arrs**</span>
<span class="c1">#</span>
<span class="c1">#**17. pad__(a, pad_with=None, size=(1, 1))**</span>
<span class="c1">#</span>
<span class="c1">#**18. stride(a, r_c=(3, 3))**</span>
<span class="c1">#</span>
<span class="c1">#Produce a strided array using a window of r_c shape.</span>
<span class="c1">#</span>
<span class="c1">#Calls _check(a, r_c, subok=False) to check for array compliance</span>
<span class="c1">#::</span>
<span class="c1">#      a =np.arange(15).reshape(3,5)</span>
<span class="c1">#      s = stride(a)    stride     ====&gt;   slide    =====&gt;</span>
<span class="c1">#      array([[[ 0,  1,  2],  [[ 1,  2,  3],  [[ 2,  3,  4],</span>
<span class="c1">#              [ 5,  6,  7],   [ 6,  7,  8],   [ 7,  8,  9],</span>
<span class="c1">#              [10, 11, 12]],  [11, 12, 13]],  [12, 13, 14]]])</span>
<span class="c1">#</span>
<span class="c1">#`pad_`  to pad an array prior to striding or blocking</span>
<span class="c1">#</span>
<span class="c1">#`block`  calls stride with non-overlapping blocks with no padding</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#**19. block(a, win=(3, 3))**</span>
<span class="c1">#</span>
<span class="c1">#**20. sliding_window_view**</span>
<span class="c1">#</span>
<span class="c1">#    Similar to stride, but not available until python 1.16 or above</span>
<span class="c1">#</span>
<span class="c1">#**21.  block_arr(a, win=[3, 3], nodata=-1)**</span>
<span class="c1">#</span>
<span class="c1">#Block an array given an input array, a window and a nodata value::</span>
<span class="c1">#</span>
<span class="c1">#    a = np.arange(16).reshape(4,4)</span>
<span class="c1">#    block_arr(a, win=[4, 3], nodata=-1)</span>
<span class="c1">#    array([[ 0,  1,  2,  3, -1, -1],</span>
<span class="c1">#           [ 4,  5,  6,  7, -1, -1],</span>
<span class="c1">#           [ 8,  9, 10, 11, -1, -1],</span>
<span class="c1">#           [12, 13, 14, 15, -1, -1]]),</span>
<span class="c1">#    masked_array(data =</span>
<span class="c1">#        [[[0 1 2]</span>
<span class="c1">#          [4 5 6]</span>
<span class="c1">#          [8 9 10]</span>
<span class="c1">#          [12 13 14]]</span>
<span class="c1">#</span>
<span class="c1">#         [[3 -- --]</span>
<span class="c1">#          [7 -- --]</span>
<span class="c1">#          [11 -- --]</span>
<span class="c1">#          [15 -- --]]],</span>
<span class="c1">#    mask .... snipped ....</span>
<span class="c1">#</span>
<span class="c1">#rolling_stats() :</span>
<span class="c1">#    stats for a strided array</span>
<span class="c1">#</span>
<span class="c1">#    min, max, mean, sum, std, var, ptp</span>
<span class="c1">#</span>
<span class="c1">#find(a, func, this=None, count=0, keep=[], prn=False, r_lim=2)</span>
<span class="c1">#</span>
<span class="c1">#::</span>
<span class="c1">#</span>
<span class="c1">#    func - (cumsum, eq, neq, ls, lseq, gt, gteq, btwn, btwni, byond)</span>
<span class="c1">#           (        ==,  !=,  &lt;,   &lt;=,  &gt;,   &gt;=,  &gt;a&lt;, =&gt;a&lt;=,  &lt;a&gt; )</span>
<span class="c1">#</span>
<span class="c1">#`_func(fn, a, this)`</span>
<span class="c1">#</span>
<span class="c1">#    called by &#39;find&#39; see details there</span>
<span class="c1">#    (cumsum, eq, neq, ls, lseq, gt, gteq, btwn, btwni, byond)</span>
<span class="c1">#</span>
<span class="c1">#Note  see ``find1d_demo.py`` for examples</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#group_pnts(a, key_fld=&#39;ID&#39;, keep_flds=[&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;])</span>
<span class="c1">#</span>
<span class="c1">#uniq(ar, return_index=False, False, return_counts=False, axis=0)</span>
<span class="c1">#</span>
<span class="c1">#is_in(find_in, using, not_in=False)</span>
<span class="c1">#</span>
<span class="c1">#running_count</span>
<span class="c1">#</span>
<span class="c1">#sequences(data, stepsize)</span>
<span class="c1">#</span>
<span class="c1">#sort_rows_by_col(a, col=0, descending=False)</span>
<span class="c1">#</span>
<span class="c1">#Sort 2d ndarray by column::</span>
<span class="c1">#</span>
<span class="c1">#      a                           col_sort(a, col=1, descending=False)</span>
<span class="c1">#      array([[2, 3, 2, 2],        array([[2, 1, 2, 4],</span>
<span class="c1">#             [1, 4, 1, 3],               [2, 3, 2, 2],</span>
<span class="c1">#             [2, 1, 2, 4]])              [1, 4, 1, 3]])</span>
<span class="c1">#</span>
<span class="c1">#sort_cols_by_row</span>
<span class="c1">#</span>
<span class="c1">#radial_sort(pnts, cent=None)</span>
<span class="c1">#</span>
<span class="c1">#pack_last_axis</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">References</span>
<span class="sd">----------</span>
<span class="sd">general</span>

<span class="sd">`&lt;https://github.com/numpy/numpy&gt;`_.</span>

<span class="sd">`&lt;https://github.com/numpy/numpy/blob/master/numpy/lib/_iotools.py&gt;`_.</span>

<span class="sd">striding</span>

<span class="sd">`&lt;https://github.com/numpy/numpy/blob/master/numpy/lib/stride_tricks.py&gt;`_.</span>

<span class="sd">`&lt;http://www.johnvinyard.com/blog/?p=268&gt;`_.</span>

<span class="sd">for strided arrays</span>

<span class="sd">`&lt;https://stackoverflow.com/questions/47469947/as-strided-linking-stepsize-</span>
<span class="sd">strides-of-conv2d-with-as-strided-strides-paramet#47470711&gt;`_.</span>

<span class="sd">`&lt;https://stackoverflow.com/questions/48097941/strided-convolution-of-2d-in-</span>
<span class="sd">numpy&gt;`_.</span>

<span class="sd">`&lt;https://stackoverflow.com/questions/45960192/using-numpy-as-strided-</span>
<span class="sd">function-to-create-patches-tiles-rolling-or-sliding-w&gt;`_.</span>

<span class="sd">numpy, stride for convolve 4d</span>

<span class="sd">`&lt;https://stackoverflow.com/questions/2828059/sorting-arrays-in-numpy-by-</span>
<span class="sd">column&gt;`_.</span>

<span class="sd">Functions Alphabetical listing::</span>

<span class="sd">    __all__             __builtins__        __cached__          __doc__</span>
<span class="sd">    __file__            __loader__          __name__            __package__</span>
<span class="sd">    __spec__            _demo_tools         _func               arr2xyz</span>
<span class="sd">    arrays_struct       block               block_arr           change_arr</span>
<span class="sd">    concat_arrs         find                find_closest        group_pnt</span>
<span class="sd">    group_vals          is_in               make_blocks         make_flds</span>
<span class="sd">    nd2rec              nd2struct           nd_rec              nd_struct           needed</span>
<span class="sd">    pack_last_axis      pad_                pad_sides           pyramid</span>
<span class="sd">    rc_vals             reclass             rolling_stats       running_count</span>
<span class="sd">    scale               script              sequences</span>
<span class="sd">    sliding_window_view split_array         stride</span>
<span class="sd">    uniq                warnings            xy_vals</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># pylint: disable=C0103  # invalid-name</span>
<span class="c1"># pylint: disable=R0914  # Too many local variables</span>
<span class="c1"># pylint: disable=R1710  # inconsistent-return-statements</span>
<span class="c1"># pylint: disable=W0105  # string statement has no effect</span>


<span class="c1"># ---- imports, formats, constants -------------------------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="k">import</span> <span class="n">dedent</span><span class="p">,</span> <span class="n">indent</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># from numpy.lib.stride_tricks import as_strided</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;arr2xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;make_blocks&#39;</span><span class="p">,</span>     <span class="c1"># (1-6) ndarrays ... make arrays,</span>
           <span class="s1">&#39;group_vals&#39;</span><span class="p">,</span> <span class="s1">&#39;reclass&#39;</span><span class="p">,</span>      <span class="c1">#     change shape, arangement</span>
           <span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;split_array&#39;</span><span class="p">,</span>
           <span class="s1">&#39;make_flds&#39;</span><span class="p">,</span> <span class="s1">&#39;nd_rec&#39;</span><span class="p">,</span>        <span class="c1"># (7-14) structured/recdarray</span>
           <span class="s1">&#39;nd_struct&#39;</span><span class="p">,</span> <span class="s1">&#39;nd2struct&#39;</span><span class="p">,</span>
           <span class="s1">&#39;nd2rec&#39;</span><span class="p">,</span> <span class="s1">&#39;rc_vals&#39;</span><span class="p">,</span> <span class="s1">&#39;xy_vals&#39;</span><span class="p">,</span>
           <span class="s1">&#39;arrays_struct&#39;</span><span class="p">,</span>
           <span class="s1">&#39;change_arr&#39;</span><span class="p">,</span> <span class="s1">&#39;concat_arrs&#39;</span><span class="p">,</span>  <span class="c1"># (15-16) change/modify arrays</span>
           <span class="s1">&#39;pad_&#39;</span><span class="p">,</span> <span class="s1">&#39;stride&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">,</span>    <span class="c1"># (17-22) stride, block and pad</span>
           <span class="s1">&#39;sliding_window_view&#39;</span><span class="p">,</span>
           <span class="s1">&#39;block_arr&#39;</span><span class="p">,</span> <span class="s1">&#39;rolling_stats&#39;</span><span class="p">,</span>
           <span class="s1">&#39;_func&#39;</span><span class="p">,</span> <span class="s1">&#39;find&#39;</span><span class="p">,</span> <span class="s1">&#39;find_closest&#39;</span><span class="p">,</span>  <span class="c1"># (23-28) querying, analysis</span>
           <span class="s1">&#39;group_pnts&#39;</span><span class="p">,</span>
           <span class="s1">&#39;uniq&#39;</span><span class="p">,</span> <span class="s1">&#39;is_in&#39;</span><span class="p">,</span>
           <span class="s1">&#39;running_count&#39;</span><span class="p">,</span> <span class="s1">&#39;sequences&#39;</span><span class="p">,</span>
           <span class="s1">&#39;pack_last_axis&#39;</span>  <span class="c1"># extras -------</span>
           <span class="p">]</span>


<span class="n">ft</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bool&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)),</span>
      <span class="s1">&#39;float_kind&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{: 8.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">}</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span>
        <span class="n">edgeitems</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
        <span class="n">floatmode</span><span class="o">=</span><span class="s1">&#39;maxprec&#39;</span><span class="p">,</span>
        <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">nanstr</span><span class="o">=</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="n">infstr</span><span class="o">=</span><span class="s1">&#39;inf&#39;</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">ft</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_print_option</span><span class="o">.</span><span class="n">set_display</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>  <span class="c1"># change to a single -</span>

<span class="n">script</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># print this should you need to locate the script</span>



<span class="c1"># ---- (1) ndarrays ... code section .... ----</span>
<span class="c1"># ---- make arrays, change shape, arrangement</span>
<span class="c1"># ---- arr2xyz, makeblocks, rc_vals, xy_vals ----</span>
<span class="c1">#</span>
<div class="viewcode-block" id="arr2xyz"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.arr2xyz">[docs]</a><span class="k">def</span> <span class="nf">arr2xyz</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">keep_masked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Produce an array such that the row, column values are used for x,y</span>
<span class="sd">    and array values for z.  Masked arrays are sorted.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    A mesh grid with values, dimensions and shapes are changed so</span>
<span class="sd">    that ndim=2, ie shape(3,4,5), ndim=3 becomes shape(12,5), ndim=2</span>

<span class="sd">    ::</span>
<span class="sd">        #&gt;&gt;&gt; a = np.arange(9).reshape(3, 3)</span>
<span class="sd">        #array([[0, 1, 2],</span>
<span class="sd">        #       [3, 4, 5],</span>
<span class="sd">        #       [6, 7, 8]])</span>
<span class="sd">        #&gt;&gt;&gt; arr2xyz(am, keep_masked=True)   # keep the masked values...</span>
<span class="sd">        #masked_array(data =</span>
<span class="sd">        #[[0 0 0]</span>
<span class="sd">        # [1 0 -]</span>
<span class="sd">        # [2 0 2]</span>
<span class="sd">        # [0 1 -]</span>
<span class="sd">        # [1 1 4]</span>
<span class="sd">        # [2 1 -]</span>
<span class="sd">        # [0 2 6]</span>
<span class="sd">        # [1 2 7]</span>
<span class="sd">        # [2 2 8]],</span>
<span class="sd">        #         mask =</span>
<span class="sd">        # [[False False False]... snip</span>
<span class="sd">        # [False False False]],</span>
<span class="sd">        #       fill_value = 999999)</span>
<span class="sd">        #&gt;&gt;&gt;</span>
<span class="sd">        #&gt;&gt;&gt; arr2xyz(am, keep_masked=False)  # remove the masked values</span>
<span class="sd">        #array([[0, 0, 0],</span>
<span class="sd">        #       [2, 0, 2],</span>
<span class="sd">        #       [1, 1, 4],</span>
<span class="sd">        #       [0, 2, 6],</span>
<span class="sd">        #       [1, 2, 7],</span>
<span class="sd">        #       [2, 2, 8]])</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    xy_vals and rc_vals for simpler versions.</span>

<span class="sd">    num_to_mask and  num_to_nan if you want structured arrays,</span>
<span class="sd">    to produce masks prior to conversion.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">XX</span><span class="p">,</span> <span class="n">YY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
    <span class="n">XX</span> <span class="o">=</span> <span class="n">XX</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">YY</span> <span class="o">=</span> <span class="n">YY</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">XX</span><span class="p">,</span> <span class="n">YY</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_masked</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span>
            <span class="n">tbl</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">XX</span><span class="p">,</span> <span class="n">YY</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">frmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        ----------------------------</span>
<span class="s2">        Meshgrid demo: array to x,y,z table</span>
<span class="s2">        :Formulation...</span>
<span class="s2">        :  XX,YY = np.meshgrid(np.arange(x.shape[1]),np.arange(x.shape[0]))</span>
<span class="s2">        :Input table</span>
<span class="s2">        </span><span class="si">{!r:&lt;}</span><span class="s2"></span>
<span class="s2">        :Raveled array, using x.ravel()</span>
<span class="s2">        </span><span class="si">{!r:&lt;}</span><span class="s2"></span>
<span class="s2">        :XX in mesh: columns shape[1]</span>
<span class="s2">        </span><span class="si">{!r:&lt;}</span><span class="s2"></span>
<span class="s2">        :YY in mesh: rows shape[0]</span>
<span class="s2">        </span><span class="si">{!r:&lt;}</span><span class="s2"></span>
<span class="s2">        :Output:</span>
<span class="s2">        </span><span class="si">{!r:&lt;}</span><span class="s2"></span>
<span class="s2">        :-----------------------------</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="n">frmt</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">XX</span><span class="p">,</span> <span class="n">YY</span><span class="p">,</span> <span class="n">tbl</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tbl</span></div>


<div class="viewcode-block" id="make_blocks"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.make_blocks">[docs]</a><span class="k">def</span> <span class="nf">make_blocks</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make a block array with rows * cols containing r*c sub windows.</span>
<span class="sd">    Specify the rows, columns, then the block size as r, c and dtype</span>
<span class="sd">    Use `scale`, if you want specific values during array construction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rows : integer</span>
<span class="sd">        rows in initial array</span>
<span class="sd">    cols : integer</span>
<span class="sd">        columns in the initial array</span>
<span class="sd">    r : integer</span>
<span class="sd">        rows in sub window</span>
<span class="sd">    c : integer</span>
<span class="sd">        columns in sub window</span>
<span class="sd">    dt : np.dtype</span>
<span class="sd">        array data type</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    The defaults produce an 8 column by 8 row array numbered from</span>
<span class="sd">    0 to (rows*cols) - 1</span>

<span class="sd">    &gt;&gt;&gt; array.shape = (rows * r, cols * c)  # (6, 6)</span>

<span class="sd">    &gt;&gt;&gt; make_blocks(rows=3, cols=3, r=2, c=2, dt=&#39;int&#39;)</span>
<span class="sd">    array([[0, 0, 1, 1, 2, 2],</span>
<span class="sd">           [0, 0, 1, 1, 2, 2],</span>
<span class="sd">           [3, 3, 4, 4, 5, 5],</span>
<span class="sd">           [3, 3, 4, 4, 5, 5],</span>
<span class="sd">           [6, 6, 7, 7, 8, 8],</span>
<span class="sd">           [6, 6, 7, 7, 8, 8]])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rows</span><span class="o">*</span><span class="n">cols</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">scale</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span></div>


<div class="viewcode-block" id="group_vals"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.group_vals">[docs]</a><span class="k">def</span> <span class="nf">group_vals</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oper</span><span class="o">=</span><span class="s1">&#39;!=&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Group consecutive values separated by no more than delta</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    seq : array, list tuple</span>
<span class="sd">        sequence of values</span>
<span class="sd">    delta : number</span>
<span class="sd">        difference between consecutive values</span>
<span class="sd">    oper : string</span>
<span class="sd">        &#39;eq&#39;, &#39;==&#39;, &#39;ne&#39;, &#39;!=&#39;, &#39;gt&#39;, &#39;&gt;&#39;, &#39;lt&#39;, &#39;&lt;&#39;</span>

<span class="sd">    References</span>
<span class="sd">    ---------</span>
<span class="sd">    `&lt;https://stackoverflow.com/questions/7352684/</span>
<span class="sd">    how-to-find-the-groups-of-consecutive-elements-from-an-array-in-numpy&gt;`_.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    &gt;&gt;&gt; a = [1, 1, 1, 2, 2, 3, 1, 1, 1]</span>
<span class="sd">    &gt;&gt;&gt; group_vals(a, delta=0, oper=&#39;!=&#39;)  # sequential difference !=0</span>
<span class="sd">    [array([1, 1, 1]), array([2, 2]), array([3]), array([1, 1, 1])]</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    split_array : form structured or recarrays</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;ne&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;gt&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;lt&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">oper</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;operand not in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">valid</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">oper</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;eq&#39;</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">==</span> <span class="n">delta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">oper</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;ne&#39;</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">!=</span> <span class="n">delta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">oper</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;gt&#39;</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">delta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">oper</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;lt&#39;</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">delta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">seq</span>
    <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="reclass"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.reclass">[docs]</a><span class="k">def</span> <span class="nf">reclass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_bins</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1">#, mask_=False, mask_val=None):</span>
    <span class="sd">&quot;&quot;&quot;Reclass an array of integer or floating point values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bins : list/tuple</span>
<span class="sd">        sequential list/array of the lower limits of each class</span>
<span class="sd">        include one value higher to cover the upper range.</span>
<span class="sd">    new_bins : list/tuple</span>
<span class="sd">        new class values for each bin</span>
<span class="sd">    mask : boolean **deferred**</span>
<span class="sd">        whether the raster contains nodata values or values to</span>
<span class="sd">        be masked with mask_val</span>
<span class="sd">    mask_val: number **deferred**</span>
<span class="sd">        value to be masked</span>

<span class="sd">    Array dimensions will be squeezed.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    inputs::</span>

<span class="sd">        z = np.arange(3*5).reshape(3,5)</span>
<span class="sd">        bins = [0, 5, 10, 15]</span>
<span class="sd">        new_bins = [1, 2, 3, 4]</span>
<span class="sd">        z_recl = reclass(z, bins, new_bins, mask=False, mask_val=None)</span>

<span class="sd">    outputs::</span>

<span class="sd">        ==&gt; .... z                     ==&gt; .... z_recl</span>
<span class="sd">        array([[ 0,  1,  2,  3,  4],   array([[1, 1, 1, 1, 1],</span>
<span class="sd">               [ 5,  6,  7,  8,  9],          [2, 2, 2, 2, 2],</span>
<span class="sd">               [10, 11, 12, 13, 14]])         [3, 3, 3, 3, 3]])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a_rc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">c_0</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
    <span class="n">c_1</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_bins</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
    <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;Bins = </span><span class="si">{}</span><span class="s2"> new = </span><span class="si">{}</span><span class="s2"> won&#39;t work&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">new_bins</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">c_0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">c_1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># or (len(new_bins &lt;2)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_bins</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">new_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">new_classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">new_bins</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">rc</span> <span class="ow">in</span> <span class="n">new_classes</span><span class="p">:</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="n">rc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">rc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">a_rc</span> <span class="o">=</span> <span class="n">a_rc</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q1</span> <span class="o">&amp;</span> <span class="n">q2</span><span class="p">,</span> <span class="n">rc</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a_rc</span></div>


<div class="viewcode-block" id="scale"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.scale">[docs]</a><span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scale the input array repeating the array values up by the</span>
<span class="sd">    x and y factors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    `a` : An ndarray, 1D arrays will be upcast to 2D.</span>

<span class="sd">    `x y` : Factors to scale the array in x (col) and y (row).  Scale factors</span>
<span class="sd">    must be greater than 2.</span>

<span class="sd">    `num_z` : For 3D, produces the 3rd dimension, ie. if num_z = 3 with the</span>
<span class="sd">    defaults, you will get an array with shape=(3, 6, 6),</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a = np.array([[0, 1, 2], [3, 4, 5]]</span>
<span class="sd">    &gt;&gt;&gt; b = scale(a, x=2, y=2)</span>
<span class="sd">    array([[0, 0, 1, 1, 2, 2],</span>
<span class="sd">           [0, 0, 1, 1, 2, 2],</span>
<span class="sd">           [3, 3, 4, 4, 5, 5],</span>
<span class="sd">           [3, 3, 4, 4, 5, 5]])</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    &gt;&gt;&gt; a = np.arange(2*2).reshape(2,2)</span>
<span class="sd">    array([[0, 1],</span>
<span class="sd">           [2, 3]])</span>

<span class="sd">    &gt;&gt;&gt; frmt_(scale(a, x=2, y=2, num_z=2))</span>
<span class="sd">    Array... shape (3, 4, 4), ndim 3, not masked</span>
<span class="sd">      0, 0, 1, 1    0, 0, 1, 1    0, 0, 1, 1</span>
<span class="sd">      0, 0, 1, 1    0, 0, 1, 1    0, 0, 1, 1</span>
<span class="sd">      2, 2, 3, 3    2, 2, 3, 3    2, 2, 3, 3</span>
<span class="sd">      2, 2, 3, 3    2, 2, 3, 3    2, 2, 3, 3</span>
<span class="sd">      sub (0)       sub (1)       sub (2)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x or y scale &lt; 1... read the docs</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scale</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># repeat for x, then tile</span>
    <span class="n">z1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>         <span class="c1"># split into y parts horizontally</span>
    <span class="n">z2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">z1</span><span class="p">)</span>            <span class="c1"># stack them vertically</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>            <span class="c1"># if there are more, repeat</span>
        <span class="n">z3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">z2</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">z3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">z3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">z2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_z</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">z3</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_z</span><span class="p">):</span>
            <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z3</span><span class="p">)</span>
        <span class="n">z3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">z3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">z3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">z3</span></div>


<div class="viewcode-block" id="split_array"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.split_array">[docs]</a><span class="k">def</span> <span class="nf">split_array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fld</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split a structured or recarray array using unique values in the</span>
<span class="sd">    `fld` field.  It is assumed that there is a sequential ordering to</span>
<span class="sd">    the values in the field.  If there is not, use np.where in conjunction</span>
<span class="sd">    with np.unique or sort the array first.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    `a` : A structured or recarray.</span>

<span class="sd">    `fld` : A numeric field assumed to be sorted which indicates which group</span>
<span class="sd">    a record belongs to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A list of arrays split on the categorizing field</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ordered</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">fld</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">uni</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">fld</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uni</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">fld</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># ---- (2) structured/recdarray section, change format or arrangement ----</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># ---- make_flds, nd_rec, nd_struct, nd_struct, np2rec, rc_vals, xy_vals</span>
<span class="c1">#</span>
<div class="viewcode-block" id="make_flds"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.make_flds">[docs]</a><span class="k">def</span> <span class="nf">make_flds</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">def_name</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create float or integer fields for statistics and their names.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : integer</span>
<span class="sd">        number of fields to create excluding the names field</span>
<span class="sd">    def_name : string</span>
<span class="sd">        base name to use, numeric values will be produced for each dimension</span>
<span class="sd">        for the 3D array, ie Values_00... Values_nn</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a dtype : which contains the necessary fields to contain the values.</span>

<span class="sd">    &gt;&gt;&gt; from numpy.lib._iotools import easy_dtype as easy</span>
<span class="sd">    &gt;&gt;&gt; make_flds(n=1, as_type=&#39;float&#39;, names=None, def_name=&quot;col&quot;)</span>
<span class="sd">    dtype([(&#39;col_00&#39;, &#39;&lt;f8&#39;)])</span>

<span class="sd">    &gt;&gt;&gt; make_flds(n=2, as_type=&#39;int&#39;, names=[&#39;f01&#39;, &#39;f02&#39;], def_name=&quot;col&quot;)</span>
<span class="sd">    dtype([(&#39;f01&#39;, &#39;&lt;i8&#39;), (&#39;f02&#39;, &#39;&lt;i8&#39;)])</span>

<span class="sd">    Don&#39;t forget the above, a cool way to create fields quickly</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">numpy.lib._iotools</span> <span class="k">import</span> <span class="n">easy_dtype</span> <span class="k">as</span> <span class="n">easy</span>
    <span class="k">if</span> <span class="n">as_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">]:</span>
        <span class="n">as_type</span> <span class="o">=</span> <span class="s1">&#39;&lt;f8&#39;</span>
    <span class="k">elif</span> <span class="n">as_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i8&#39;</span><span class="p">]:</span>
        <span class="n">as_type</span> <span class="o">=</span> <span class="s1">&#39;&lt;i8&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">as_type</span> <span class="o">=</span> <span class="s1">&#39;str&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">as_type</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{:&gt;02}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">def_name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">easy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">defaultfmt</span><span class="o">=</span><span class="n">def_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">easy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dt</span></div>


<div class="viewcode-block" id="nd_rec"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.nd_rec">[docs]</a><span class="k">def</span> <span class="nf">nd_rec</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">flds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Change a uniform array to an array of mixed dtype as a recarray</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    flds : string or None</span>
<span class="sd">        flds=&#39;a, b, c&#39;</span>
<span class="sd">    types : string or None</span>
<span class="sd">        types=&#39;U8, f8, i8&#39;</span>

<span class="sd">    See Also</span>
<span class="sd">    ---------</span>
<span class="sd">    nd_struct : alternate using lists rather than string inputs</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The a.T turns the columns to rows so that each row can be assigned a</span>
<span class="sd">    separate data type.</span>

<span class="sd">    Example::</span>

<span class="sd">       &gt;&gt;&gt; a = np.arange(9).reshape(3, 3)</span>
<span class="sd">       &gt;&gt;&gt; a_r = nd_rec(a, flds=&#39;a, b, c&#39;, types=&#39;U8, f8, i8&#39;)</span>
<span class="sd">       a_r</span>
<span class="sd">       rec.array([(&#39;0&#39;,  1., 2), (&#39;3&#39;,  4., 5), (&#39;6&#39;,  7., 8)],</span>
<span class="sd">          dtype=[(&#39;a&#39;, &#39;&lt;U8&#39;), (&#39;b&#39;, &#39;&lt;f8&#39;), (&#39;c&#39;, &#39;&lt;i8&#39;)])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">flds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><span class="p">)[:</span><span class="n">c</span><span class="p">]</span>
        <span class="n">flds</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">flds</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">types</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span>  <span class="c1"># a.dtype.descr[0][1]</span>
        <span class="n">types</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="p">)])</span>
    <span class="n">a_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">fromarrays</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
                                     <span class="n">names</span><span class="o">=</span><span class="n">flds</span><span class="p">,</span>
                                     <span class="n">formats</span><span class="o">=</span><span class="n">types</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a_r</span></div>


<div class="viewcode-block" id="nd_struct"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.nd_struct">[docs]</a><span class="k">def</span> <span class="nf">nd_struct</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">flds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Change an array with uniform dtype to an array of mixed dtype as a</span>
<span class="sd">    structured array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    flds : list or None</span>
<span class="sd">        flds=[&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span>
<span class="sd">    types : list or None</span>
<span class="sd">        types=[&#39;U8&#39;, &#39;f8&#39;, &#39;i8&#39;]</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    - nd_rec : alternate using strings rather than list inputs</span>
<span class="sd">    - pack_last_axis(arr, names=None) : at the end</span>
<span class="sd">    - nd2struct(a, fld_name=None : similar to this, but uniform dtype is used.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ::</span>

<span class="sd">        &gt;&gt;&gt; a = np.arange(9).reshape(3, 3)</span>
<span class="sd">        &gt;&gt;&gt; a_s = nd_struct(a, flds=[&#39;A&#39;, &#39;B&#39;, &#39;C&#39;], types=[&#39;U8&#39;, &#39;f8&#39;, &#39;i8&#39;])</span>
<span class="sd">        &gt;&gt;&gt; a_s</span>
<span class="sd">        &gt;&gt;&gt; array([(&#39;0&#39;,  1., 2), (&#39;3&#39;,  4., 5), (&#39;6&#39;,  7., 8)],</span>
<span class="sd">        &gt;&gt;&gt;       dtype=[(&#39;A&#39;, &#39;&lt;U8&#39;), (&#39;B&#39;, &#39;&lt;f8&#39;), (&#39;C&#39;, &#39;&lt;i8&#39;)])</span>

<span class="sd">    Timing of nd_rec and nd_struct::</span>

<span class="sd">        &gt;&gt;&gt; %timeit nd_rec(a, flds=&#39;a, b, c&#39;, types=&#39;U8, f8, i8&#39;)</span>
<span class="sd">        465 µs ± 53 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)</span>
<span class="sd">        &gt;&gt;&gt; %timeit nd_struct(a, flds=[&#39;A&#39;, &#39;B&#39;, &#39;C&#39;], types=[&#39;U8&#39;, &#39;f8&#39;, &#39;i8&#39;])</span>
<span class="sd">        253 µs ± 27.1 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">dt_base</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span>  <span class="c1"># a.dtype.descr[0][1]</span>
    <span class="k">if</span> <span class="n">flds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><span class="p">)[:</span><span class="n">c</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">types</span> <span class="o">=</span> <span class="n">dt_base</span>
    <span class="n">dt0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">flds</span><span class="p">,</span> <span class="n">dt_base</span><span class="p">)))</span>
    <span class="n">dt1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">flds</span><span class="p">,</span> <span class="n">types</span><span class="p">))</span>
    <span class="n">a_s</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dt0</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dt1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a_s</span></div>


<div class="viewcode-block" id="nd2struct"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.nd2struct">[docs]</a><span class="k">def</span> <span class="nf">nd2struct</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fld_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a view of an ndarray as structured array with a uniform dtype.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array</span>
<span class="sd">        ndarray with a uniform dtype.</span>
<span class="sd">    fld_names : list/tuple</span>
<span class="sd">        One name for each column/field.  If none are provided, then the field</span>
<span class="sd">        names are assigned from an alphabetical list up to 26 fields.</span>
<span class="sd">        The dtype of the input array is retained, but can be upcast.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a = np.arange(2*3).reshape(2, 3)</span>
<span class="sd">    array([[0, 1, 2],</span>
<span class="sd">           [3, 4, 5]])  # dtype(&#39;int64&#39;)</span>
<span class="sd">    &gt;&gt;&gt; b = nd2struct(a)</span>
<span class="sd">    array([(0, 1, 2), (3, 4, 5)],</span>
<span class="sd">          dtype=[(&#39;A&#39;, &#39;&lt;i8&#39;), (&#39;B&#39;, &#39;&lt;i8&#39;), (&#39;C&#39;, &#39;&lt;i8&#39;)])</span>
<span class="sd">    &gt;&gt;&gt; c = nd2struct(a.astype(np.float64))</span>
<span class="sd">    array([( 0.,  1.,  2.), ( 3.,  4.,  5.)],</span>
<span class="sd">          dtype=[(&#39;A&#39;, &#39;&lt;f8&#39;), (&#39;B&#39;, &#39;&lt;f8&#39;), (&#39;C&#39;, &#39;&lt;f8&#39;)])</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    - pack_last_axis(arr, names=None) at the end</span>
<span class="sd">     -nd_struct(flds=None, types=None)  if you want to provide dtypes as well</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>  <span class="c1"># return if a structured array already</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="n">alph</span> <span class="o">=</span> <span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">frmt</span> <span class="o">=</span> <span class="s2">&quot;Wrong array shape... read the docs..</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">frmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nd2struct</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">fld_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">alph</span><span class="p">)[:</span><span class="n">cols</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fld_names</span><span class="p">)</span> <span class="o">==</span> <span class="n">cols</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cols</span> <span class="o">&lt;</span> <span class="mi">26</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">fld_names</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># from... pack_last_axis</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;f</span><span class="si">{:02.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">view</span><span class="p">([(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="nd2rec"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.nd2rec">[docs]</a><span class="k">def</span> <span class="nf">nd2rec</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fld_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shell to nd2struct but yielding a recarray.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">nd2struct</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fld_names</span><span class="o">=</span><span class="n">fld_names</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">recarray</span><span class="p">)</span></div>


<div class="viewcode-block" id="rc_vals"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.rc_vals">[docs]</a><span class="k">def</span> <span class="nf">rc_vals</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert array to rcv, for 2D arrays.  See xy_val for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">c</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Row&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Col&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Val&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">)]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="s1">&#39;Row&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">out</span><span class="p">[</span><span class="s1">&#39;Col&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">out</span><span class="p">[</span><span class="s1">&#39;Val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="xy_vals"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.xy_vals">[docs]</a><span class="k">def</span> <span class="nf">xy_vals</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert array to xyz, for 2D arrays</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array</span>
<span class="sd">        2D array of values</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Triplets of x, y and vals as an nx3 array</span>

<span class="sd">    &gt;&gt;&gt; a = np.random.randint(1,5,size=(2,4))</span>
<span class="sd">    &gt;&gt;&gt; a</span>
<span class="sd">    array([[4, 1, 4, 3],</span>
<span class="sd">           [2, 3, 1, 3]])</span>
<span class="sd">    &gt;&gt;&gt; xy_val(a)</span>
<span class="sd">    array([(0, 0, 4), (1, 0, 1), (2, 0, 4), (3, 0, 3),</span>
<span class="sd">           (0, 1, 2), (1, 1, 3), (2, 1, 1), (3, 1, 3)],</span>
<span class="sd">          dtype=[(&#39;X&#39;, &#39;&lt;i8&#39;), (&#39;Y&#39;, &#39;&lt;i8&#39;), (&#39;Val&#39;, &#39;&lt;i4&#39;)])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">c</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Val&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">)]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">out</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">out</span><span class="p">[</span><span class="s1">&#39;Val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">out</span></div>


<span class="c1"># ---- arrays_cols ----</span>
<div class="viewcode-block" id="arrays_struct"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.arrays_struct">[docs]</a><span class="k">def</span> <span class="nf">arrays_struct</span><span class="p">(</span><span class="n">arrs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Stack arrays of any dtype to form a structured array, stacked in</span>
<span class="sd">    columns format.</span>

<span class="sd">    fix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arrs</span>
    <span class="n">out_dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">out_dt</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">out_dt</span><span class="p">)</span><span class="o">.</span><span class="n">names</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">out</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span></div>


<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># ---- (3) change/modify arrays ... code section ----</span>
<span class="c1"># ---- change_arr, scale, split_array, concat_arrs</span>
<span class="c1">#</span>
<div class="viewcode-block" id="change_arr"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.change_arr">[docs]</a><span class="k">def</span> <span class="nf">change_arr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prn</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reorder and/or drop columns in an ndarray or structured array.</span>

<span class="sd">    Fields not included will be dropped in the output array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    order : list of field names or order numbers</span>
<span class="sd">        fields in the order that you want them</span>
<span class="sd">    prn : boolean</span>
<span class="sd">        True, prints additional information prior to returning the array</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    reorder fields : [&#39;a&#39;, &#39;c&#39;, &#39;b&#39;]</span>
<span class="sd">        For a structured/recarray, the desired field order is required.</span>
<span class="sd">        An ndarray, not using named fields, will require the numerical</span>
<span class="sd">        order of the fields.</span>

<span class="sd">    remove fields : [&#39;a&#39;, &#39;c&#39;]   ...  `b` is dropped</span>
<span class="sd">        To remove fields, simply leave them out of the list.  The</span>
<span class="sd">        order of the remaining fields will be reflected in the output.</span>
<span class="sd">        This is a convenience function.... see the module header for</span>
<span class="sd">        one-liner syntax.</span>

<span class="sd">    Tip :</span>
<span class="sd">        Use... `arraytools._base_functions.arr_info(a, verbose=True)`</span>
<span class="sd">        This gives field names which can be copied for use here.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Order not given in a list or tuple&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
    <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">order</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># only for structured arrays</span>
        <span class="n">out_flds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">out_flds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">prn</span><span class="p">:</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">order</span><span class="p">]</span>
            <span class="n">missing</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out_flds</span><span class="p">])</span>
            <span class="n">frmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            : change(a)</span>
<span class="s2">            : - field(s) </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">            : - not found, missing or removed.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="n">frmt</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">out_flds</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">b</span></div>


<div class="viewcode-block" id="concat_arrs"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.concat_arrs">[docs]</a><span class="k">def</span> <span class="nf">concat_arrs</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Concatenate a sequence of arrays to string format and return a</span>
<span class="sd">    structured array or ndarray</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arrs : list</span>
<span class="sd">        A list of single arrays of the same length</span>
<span class="sd">    sep : string</span>
<span class="sd">        The separator between lists</span>
<span class="sd">    name : string</span>
<span class="sd">        A default name used for constructing the array field names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arrs</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arrs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">sze</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">sze</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span>
    <span class="k">if</span> <span class="n">with_ids</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;IDs&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sze</span><span class="p">)]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">c</span><span class="p">[</span><span class="s1">&#39;IDs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
    <span class="k">return</span> <span class="n">c</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># ---- (4) stride, block and pad .... code section</span>
<span class="c1"># ----  pad_, stride, sliding_window_view, block</span>
<span class="c1">#</span>
<div class="viewcode-block" id="pad_"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.pad_">[docs]</a><span class="k">def</span> <span class="nf">pad_</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">pad_with</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;To use when padding a strided array for window construction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pad_with : number</span>
<span class="sd">        Options for number types</span>
<span class="sd">    - ints : 0, +/-128, +/-32768 `np.iinfo(np.int16).min or max 8, 16, 32`.</span>
<span class="sd">    - float : 0., np.nan, np.inf, `-np.inf` or `np.finfo(float64).min or max`</span>
<span class="sd">    size : list/tuple</span>
<span class="sd">        Size of padding on sides in cells.</span>
<span class="sd">    - 2D : 1 cell =&gt; (1,1)</span>
<span class="sd">    - 3D : 1 cell =&gt; (1,1,1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pad_with</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="c1">#</span>
    <span class="n">new_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">pad_with</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tmp</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">elif</span> <span class="n">tmp</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">tmp</span>
    <span class="k">return</span> <span class="n">a</span></div>


<span class="k">def</span> <span class="nf">pad_sides</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">TL</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">RB</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pad an array&#39;s T(op), L(eft), B(ottom) and R(ight) sides with `value`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    `pad_by` : tuple of integers</span>
<span class="sd">        Pad the T, B rows and L, R columns.</span>
<span class="sd">    `value` : integer</span>
<span class="sd">        Value to use on all axes</span>

<span class="sd">    &gt;&gt;&gt; a np.array([[0, 1, 2], [3, 4, 5]])</span>
<span class="sd">    &gt;&gt;&gt; pad_sides(a, (0, 1, 0, 1), -1)</span>
<span class="sd">    array([[ 0,  1,  2, -1],</span>
<span class="sd">           [ 3,  4,  5, -1],</span>
<span class="sd">           [-1, -1, -1, -1]])</span>
<span class="sd">    &gt;&gt;&gt; pad_sides(a, (1, 0, 0, 2), -1)</span>
<span class="sd">    array([[-1, -1, -1, -1, -1],</span>
<span class="sd">           [ 0,  1,  2, -1, -1],</span>
<span class="sd">           [ 3,  4,  5, -1, -1]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">L</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">TL</span>
    <span class="n">R</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">RB</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="p">((</span><span class="n">T</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span>
               <span class="n">constant_values</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span>


<span class="k">def</span> <span class="nf">needed</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;pad size for right bottom padding given array shape and window size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shp</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">RB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">shp</span><span class="p">,</span> <span class="n">win</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">RB</span>


<div class="viewcode-block" id="stride"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.stride">[docs]</a><span class="k">def</span> <span class="nf">stride</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stepby</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Provide a 2D sliding/moving view of an array.</span>
<span class="sd">    There is no edge correction for outputs. Use the `pad_` function first.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    as_strided : function</span>
<span class="sd">        from numpy.lib.stride_tricks import as_strided</span>
<span class="sd">    a : array or list</span>
<span class="sd">        Usually a 2D array.  Assumes rows &gt;=1, it is corrected as is the</span>
<span class="sd">        number of columns.</span>
<span class="sd">    win, stepby : array-like</span>
<span class="sd">        tuple/list/array of window strides by dimensions</span>
<span class="sd">    Recommendations::</span>

<span class="sd">        - 1D - (3,)       (1,)       3 elements, step by 1</span>
<span class="sd">        - 2D - (3, 3)     (1, 1)     3x3 window, step by 1 rows and col.</span>
<span class="sd">        - 3D - (1, 3, 3)  (1, 1, 1)  1x3x3, step by 1 row, col, depth</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a = np.arange(10)</span>
<span class="sd">    &gt;&gt;&gt; # stride(a, (3,), (1,)) 3 value moving window, step by 1</span>
<span class="sd">    &gt;&gt;&gt; stride(a, (3,), (2,))</span>
<span class="sd">    array([[0, 1, 2],</span>
<span class="sd">    ...    [2, 3, 4],</span>
<span class="sd">    ...    [4, 5, 6],</span>
<span class="sd">    ...    [6, 7, 8]])</span>
<span class="sd">    &gt;&gt;&gt; a = np.arange(6*6).reshape(6, 6)</span>
<span class="sd">    &gt;&gt;&gt; stride(a, (3, 3), (1, 1))  # sliding window</span>
<span class="sd">    &gt;&gt;&gt; stride(a, (3, 3), (3, 3))  # block an array</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    &gt;&gt;&gt; np.product(a.shape) == a.size   # shape product equals array size</span>
<span class="sd">    &gt;&gt;&gt; # To check if the base array and the strided version share memory</span>
<span class="sd">    &gt;&gt;&gt; np.may_share_memory(a, a_s)     # True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Array shape, window and/or step size error.</span>
<span class="s2">    Use win=(3,) with stepby=(1,) for 1D array</span>
<span class="s2">    or win=(3,3) with stepby=(1,1) for 2D array</span>
<span class="s2">    or win=(1,3,3) with stepby=(1,1,1) for 3D</span>
<span class="s2">    ----    a.ndim != len(win) != len(stepby) ----</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">numpy.lib.stride_tricks</span> <span class="k">import</span> <span class="n">as_strided</span>
    <span class="n">a_ndim</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">win</span> <span class="o">=</span> <span class="p">(</span><span class="n">win</span><span class="p">,)</span> <span class="o">*</span> <span class="n">a_ndim</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stepby</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">stepby</span> <span class="o">=</span> <span class="p">(</span><span class="n">stepby</span><span class="p">,)</span> <span class="o">*</span> <span class="n">a_ndim</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">a_ndim</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">win</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">win</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">stepby</span><span class="p">)),</span> <span class="n">err</span>
    <span class="n">shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>    <span class="c1"># array shape (r, c) or (d, r, c)</span>
    <span class="n">win_shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>    <span class="c1"># window      (3, 3) or (1, 3, 3)</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stepby</span><span class="p">)</span>      <span class="c1"># step by     (1, 1) or (1, 1, 1)</span>
    <span class="n">newshape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(((</span><span class="n">shp</span> <span class="o">-</span> <span class="n">win_shp</span><span class="p">)</span> <span class="o">//</span> <span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">win_shp</span><span class="p">)</span>
    <span class="n">newstrides</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">strides</span><span class="p">)</span> <span class="o">*</span> <span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">strides</span>
    <span class="n">a_s</span> <span class="o">=</span> <span class="n">as_strided</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">newshape</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="n">newstrides</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">a_s</span></div>


<span class="c1"># ---- sliding_window_view .... new ----</span>
<div class="viewcode-block" id="sliding_window_view"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.sliding_window_view">[docs]</a><span class="k">def</span> <span class="nf">sliding_window_view</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create rolling window views of the 2D array with the given shape.</span>
<span class="sd">    proposed for upcoming numpy version.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : 2D array</span>
<span class="sd">    shape : tuple</span>
<span class="sd">        window size. eg. (3, 3), (2, 2) etc</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    `&lt;https://github.com/numpy/numpy/pull/10771&gt;`_.</span>

<span class="sd">    `&lt;https://github.com/scikit-image/scikit-image/blob/master/skimage/</span>
<span class="sd">    util/shape.py#L107&gt;`_.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    view_as_windows and view_as_blocks</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># output shape</span>
    <span class="n">strides</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">strides</span>
    <span class="n">view_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">o</span><span class="p">,</span> <span class="n">shape</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">view_strides</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">strides</span><span class="p">,</span> <span class="n">strides</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">stride_tricks</span><span class="o">.</span><span class="n">as_strided</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">view_shape</span><span class="p">,</span> <span class="n">view_strides</span><span class="p">)</span></div>


<div class="viewcode-block" id="block"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.block">[docs]</a><span class="k">def</span> <span class="nf">block</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Calls stride with step_by equal to win size.</span>
<span class="sd">    No padding of the array, so this works best when win size is divisible</span>
<span class="sd">    in both directions</span>

<span class="sd">    See block_arr if you want padding</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a_b</span> <span class="o">=</span> <span class="n">stride</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="n">win</span><span class="p">,</span> <span class="n">stepby</span><span class="o">=</span><span class="n">win</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a_b</span></div>


<div class="viewcode-block" id="block_arr"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.block_arr">[docs]</a><span class="k">def</span> <span class="nf">block_arr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">as_masked</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Block array into window sized chunks padding to the right and bottom</span>
<span class="sd">    to accommodate array and window shape.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array</span>
<span class="sd">        2D array</span>
<span class="sd">    win : [integer, integer]</span>
<span class="sd">        [rows, cols], aka y,x, m,n sized window</span>
<span class="sd">    nodata : number</span>
<span class="sd">        to use for the mask</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The padded array and the masked array blocked.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    `&lt;http://stackoverflow.com/questions/40275876/how-to-reshape-this-image-</span>
<span class="sd">    array-in-python&gt;`_.</span>

<span class="sd">    &gt;&gt;&gt; def block_2(a, blocks=2)</span>
<span class="sd">            B = blocks # Blocksize</span>
<span class="sd">            m, n = a.shape</span>
<span class="sd">            out = a.reshape(m//B, B, n//B, B).swapaxes(1, 2).reshape(-1, B, B)</span>
<span class="sd">            return out</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">win</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">....... Read the docs .....</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_arr</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">win</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">win</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">win</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ypad</span><span class="p">,</span> <span class="n">xpad</span> <span class="o">=</span> <span class="n">s2</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">ypad</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xpad</span><span class="p">))</span>
    <span class="n">p_with</span> <span class="o">=</span> <span class="p">((</span><span class="n">nodata</span><span class="p">,</span> <span class="n">nodata</span><span class="p">),</span> <span class="p">(</span><span class="n">nodata</span><span class="p">,</span> <span class="n">nodata</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">p_with</span><span class="p">)</span>
    <span class="n">w_y</span><span class="p">,</span> <span class="n">w_x</span> <span class="o">=</span> <span class="n">win</span>       <span class="c1"># Blocksize</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span>       <span class="c1"># padded array</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">y</span><span class="o">//</span><span class="n">w_y</span><span class="p">,</span> <span class="n">w_y</span><span class="p">,</span> <span class="n">x</span><span class="o">//</span><span class="n">w_x</span><span class="p">,</span> <span class="n">w_x</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">w_y</span><span class="p">,</span> <span class="n">w_x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">as_masked</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">nodata</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_fill_value</span><span class="p">(</span><span class="n">nodata</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c</span></div>


<div class="viewcode-block" id="rolling_stats"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.rolling_stats">[docs]</a><span class="k">def</span> <span class="nf">rolling_stats</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">no_null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Statistics on the last two dimensions of an array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array</span>
<span class="sd">        4D array  Note, use &#39;stride&#39; above to obtain rolling stats</span>
<span class="sd">    no_null : boolean</span>
<span class="sd">        Whether to use masked values (nan) or not.</span>
<span class="sd">    prn : boolean</span>
<span class="sd">        To print the results or return the values.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The results return an array of 4 dimensions representing the original 2D</span>
<span class="sd">    array size and block size.  An original 6x6 array will be broken into</span>
<span class="sd">    block 4 3x3 chunks</span>
<span class="sd">    ::</span>

<span class="sd">        &gt;&gt;&gt; array([[ 0,  1,  2,  3],  # 2D array</span>
<span class="sd">                   [ 4,  5,  6,  7],</span>
<span class="sd">                   [ 8,  9, 10, 11],</span>
<span class="sd">                   [12, 13, 14, 15]])</span>
<span class="sd">        Array... ndim 4  shape(2, 2, 2, 2)  # blocked into 2x2</span>
<span class="sd">        |  0  1    2  3 |</span>
<span class="sd">        |  4  5    6  7 |</span>
<span class="sd">        |=&gt; (0 2 2 2)</span>
<span class="sd">        |  8  9   10 11 |</span>
<span class="sd">        | 12 13   14 15 |</span>
<span class="sd">        |=&gt; (1 2 2 2)</span>
<span class="sd">    &gt;&gt;&gt; rolling_stats(c)</span>
<span class="sd">    Min...     Max...    Mean...        Med...         Sum...</span>
<span class="sd">    [[ 0  2]   [[ 5  7]  [[ 2.5  4.5]   [[ 2.5  4.5]   [[10 18]</span>
<span class="sd">     [ 8 10]]   [13 15]]  [10.5 12.5]]   [10.5 12.5]]   [42 50]]</span>
<span class="sd">    Std...         Var...         Range...</span>
<span class="sd">    [[2.06 2.06]   [[4.25 4.25]   [[5 5]</span>
<span class="sd">     [2.06 2.06]]   [4.25 4.25]]   [5 5]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">))[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
    <span class="k">if</span> <span class="n">no_null</span><span class="p">:</span>
        <span class="n">a_min</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">a_max</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">a_mean</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">a_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">a_sum</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">a_std</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">a_var</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">a_ptp</span> <span class="o">=</span> <span class="n">a_max</span> <span class="o">-</span> <span class="n">a_min</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
        <span class="n">a_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
        <span class="n">a_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
        <span class="n">a_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
        <span class="n">a_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
        <span class="n">a_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
        <span class="n">a_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanvar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
        <span class="n">a_ptp</span> <span class="o">=</span> <span class="n">a_max</span> <span class="o">-</span> <span class="n">a_min</span>
    <span class="k">if</span> <span class="n">prn</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Min&#39;</span><span class="p">,</span> <span class="s1">&#39;Max&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="s1">&#39;Med&#39;</span><span class="p">,</span> <span class="s1">&#39;Sum&#39;</span><span class="p">,</span> <span class="s1">&#39;Std&#39;</span><span class="p">,</span> <span class="s1">&#39;Var&#39;</span><span class="p">,</span> <span class="s1">&#39;Range&#39;</span><span class="p">]</span>
        <span class="n">frmt</span> <span class="o">=</span> <span class="s2">&quot;...</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;...</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_min</span><span class="p">,</span> <span class="n">a_max</span><span class="p">,</span> <span class="n">a_mean</span><span class="p">,</span> <span class="n">a_med</span><span class="p">,</span> <span class="n">a_sum</span><span class="p">,</span> <span class="n">a_std</span><span class="p">,</span> <span class="n">a_var</span><span class="p">,</span> <span class="n">a_ptp</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">indent</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;... &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">frmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a_min</span><span class="p">,</span> <span class="n">a_max</span><span class="p">,</span> <span class="n">a_mean</span><span class="p">,</span> <span class="n">a_med</span><span class="p">,</span> <span class="n">a_sum</span><span class="p">,</span> <span class="n">a_std</span><span class="p">,</span> <span class="n">a_var</span><span class="p">,</span> <span class="n">a_ptp</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># ---- (5) querying, working with arrays ----</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># ---- _func, find, group_pnts, group_vals, reclass</span>
<span class="c1">#</span>
<span class="k">def</span> <span class="nf">_func</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">this</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Called by &#39;find&#39; see details there</span>
<span class="sd">    (cumsum, eq, neq, ls, lseq, gt, gteq, btwn, btwni, byond)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cumsum&#39;</span><span class="p">,</span> <span class="s1">&#39;csum&#39;</span><span class="p">,</span> <span class="s1">&#39;cu&#39;</span><span class="p">]:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">this</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">]:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">this</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;neq&#39;</span><span class="p">,</span> <span class="s1">&#39;ne&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">]:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">this</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># (a, this, invert=True)</span>
    <span class="k">elif</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="s1">&#39;les&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">]:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">this</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lseq&#39;</span><span class="p">,</span> <span class="s1">&#39;lese&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">]:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">this</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;gt&#39;</span><span class="p">,</span> <span class="s1">&#39;grt&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">this</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;gteq&#39;</span><span class="p">,</span> <span class="s1">&#39;gte&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">]:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="n">this</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;btwn&#39;</span><span class="p">,</span> <span class="s1">&#39;btw&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;a&lt;&#39;</span><span class="p">]:</span>
        <span class="n">low</span><span class="p">,</span> <span class="n">upp</span> <span class="o">=</span> <span class="n">this</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="n">low</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">upp</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;btwni&#39;</span><span class="p">,</span> <span class="s1">&#39;btwi&#39;</span><span class="p">,</span> <span class="s1">&#39;=&gt;a&lt;=&#39;</span><span class="p">]:</span>
        <span class="n">low</span><span class="p">,</span> <span class="n">upp</span> <span class="o">=</span> <span class="n">this</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="n">low</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">upp</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;byond&#39;</span><span class="p">,</span> <span class="s1">&#39;bey&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;a&gt;&#39;</span><span class="p">]:</span>
        <span class="n">low</span><span class="p">,</span> <span class="n">upp</span> <span class="o">=</span> <span class="n">this</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">low</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">upp</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">v</span>


<span class="c1"># @time_deco</span>
<div class="viewcode-block" id="find"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.find">[docs]</a><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">this</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">r_lim</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find the conditions that are met in an array, defined by `func`.</span>
<span class="sd">    `this` is the condition being looked for.  The other parameters are defined</span>
<span class="sd">    in the Parameters section.</span>

<span class="sd">    &gt;&gt;&gt; a = np.arange(10)</span>
<span class="sd">    &gt;&gt;&gt; find(a, &#39;gt&#39;, this=5)</span>
<span class="sd">    array([6, 7, 8, 9])</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    `a` : Array or array like.</span>
<span class="sd">    `func` : function</span>
<span class="sd">        `(cumsum, eq, neq, ls, lseq, gt, gteq, btwn, btwni, byond)`</span>
<span class="sd">        (        ==,  !=,  &lt;,   &lt;=,  &gt;,   &gt;=,  &gt;a&lt;, =&gt;a&lt;=,  &lt;a&gt; )</span>
<span class="sd">    `count` : integer</span>
<span class="sd">        only used for recursive functions</span>
<span class="sd">    `keep` : None</span>
<span class="sd">        for future use</span>
<span class="sd">    `prn` : boolean</span>
<span class="sd">        True for test printing</span>
<span class="sd">    `max_depth` : integer</span>
<span class="sd">        prevent recursive functions running wild, it can be varied</span>

<span class="sd">    Recursive functions :</span>
<span class="sd">        functions that call themselves</span>

<span class="sd">    cumsum :</span>
<span class="sd">        An example of using recursion to split a list/array of data</span>
<span class="sd">        parsing the results into groups that sum to this.  For example,</span>
<span class="sd">        split input into groups where the total population is less than</span>
<span class="sd">        a threshold (this).  The default is to use a sequential list,</span>
<span class="sd">        however, the inputs could be randomized prior to running.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        A 1D or 2D array meeting the conditions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1D array expected&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>              <span class="c1"># ---- ensure array format</span>
    <span class="k">if</span> <span class="n">keep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">this</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">this</span><span class="p">)</span>
    <span class="c1"># masked = np.ma.is_masked(a)    # ---- check for masked array</span>
    <span class="k">if</span> <span class="n">prn</span><span class="p">:</span>                        <span class="c1"># ---- optional print</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">) Input values....</span><span class="se">\n</span><span class="s2">  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
    <span class="n">ix</span> <span class="o">=</span> <span class="n">_func</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span>      <span class="c1"># ---- sub function -----</span>
    <span class="k">if</span> <span class="n">ix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>         <span class="c1"># ---- slice and save</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">ix</span><span class="p">)):]</span>      <span class="c1"># ---- use remainder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):]</span>
    <span class="k">if</span> <span class="n">prn</span><span class="p">:</span>                        <span class="c1"># optional print</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Remaining</span><span class="se">\n</span><span class="s2">  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="c1"># ---- recursion functions check and calls ----</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cumsum&#39;</span><span class="p">]:</span>  <span class="c1"># functions that support recursion</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">and</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="n">r_lim</span><span class="p">):</span>  <span class="c1"># len(a) &gt; 0recursive call</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">find</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">this</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">keep</span><span class="p">,</span> <span class="n">prn</span><span class="p">,</span> <span class="n">r_lim</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">count</span> <span class="o">==</span> <span class="n">r_lim</span><span class="p">:</span>
            <span class="n">frmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Recursion check... count </span><span class="si">{}</span><span class="s2"> == </span><span class="si">{}</span><span class="s2"> recursion limit</span>
<span class="s2">                   Warning...increase recursion limit, reduce sample size</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">                   or changes conditions&quot;&quot;&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="n">frmt</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">r_lim</span><span class="p">))</span>
    <span class="c1"># ---- end recursive functions ----</span>
    <span class="c1"># print(&quot;keep for {} : {}&quot;.format(func,keep))</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   <span class="c1"># for most functions, this is it</span>
        <span class="n">final</span> <span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>                <span class="c1"># for recursive functions, there will be more</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">incr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">incr</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)))))</span>
            <span class="n">incr</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;orig&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i8&#39;</span><span class="p">)]</span>
        <span class="n">final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">final</span><span class="p">[</span><span class="s1">&#39;orig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">final</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># ---- end recursive section</span>
    <span class="k">return</span> <span class="n">final</span></div>


<div class="viewcode-block" id="find_closest"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.find_closest">[docs]</a><span class="k">def</span> <span class="nf">find_closest</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">close_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Change values in an ndarray to match the closest in `close_to`.  This</span>
<span class="sd">    may be a scalar, or array-like for multiple cases.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array</span>
<span class="sd">        an ndarray of integer or floating point values</span>
<span class="sd">    close_to : number or array-like</span>
<span class="sd">        If a number, it will return `close_to` or 0.  If array-like, then the</span>
<span class="sd">        closest value in `close_to` will be returned</span>

<span class="sd">    This behaviour differs from np.digitize.</span>

<span class="sd">    &gt;&gt;&gt; a = np.array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>
<span class="sd">    &gt;&gt;&gt; find_closest(a, close_to=[3, 6, 9])</span>
<span class="sd">    array([3, 3, 3, 3, 3, 6, 6, 6, 9, 9])</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; np.digitize(a, bins=[3, 6, 9])</span>
<span class="sd">    array([0, 0, 0, 1, 1, 1, 2, 2, 2, 3], dtype=int64)</span>

<span class="sd">    For arrays with ndim &gt;= 2.</span>

<span class="sd">    &gt;&gt;&gt; a = np.array([[3, 2, 4, 3, 3],</span>
<span class="sd">                      [1, 2, 3, 4, 1],</span>
<span class="sd">                      [2, 4, 4, 1, 1]])</span>
<span class="sd">    &gt;&gt;&gt; find_closest(a, close_to=[0, 4])</span>
<span class="sd">    array([[4, 0, 4, 4, 4],</span>
<span class="sd">           [0, 0, 4, 4, 0],</span>
<span class="sd">           [0, 4, 4, 0, 0]])</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    If you set close_to to a singleton list you will get unexpected but</span>
<span class="sd">    correct results because np.isscalar returns the following conditions.</span>

<span class="sd">    &gt;&gt;&gt; np.isscalar(5)    # True</span>
<span class="sd">    &gt;&gt;&gt; np.isscalar([5])  # False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">close_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">close_to</span><span class="p">):</span>  <span class="c1"># a single number</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">close_to</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">val</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>                      <span class="c1"># a list/tuple of one or more numbers</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">close_to</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">close_to</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">close_to</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">close_to</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span></div>


<div class="viewcode-block" id="group_pnts"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.group_pnts">[docs]</a><span class="k">def</span> <span class="nf">group_pnts</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">key_fld</span><span class="o">=</span><span class="s1">&#39;IDs&#39;</span><span class="p">,</span> <span class="n">shp_flds</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Xs&#39;</span><span class="p">,</span> <span class="s1">&#39;Ys&#39;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Group points for a feature that has been exploded to points by</span>
<span class="sd">    `arcpy.da.FeatureClassToNumPyArray`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>
<span class="sd">    a : array</span>
<span class="sd">        A structured array, assuming ID, X, Y, {Z} and whatever else.</span>
<span class="sd">        The array is assumed to be sorted... which will usually be the case.</span>
<span class="sd">    key_fld : string</span>
<span class="sd">        Normally this is the `IDs` or similar</span>
<span class="sd">    shp_flds : strings</span>
<span class="sd">        The fields that are used to produce the geometry.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    See np.unique descriptions below</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    `&lt;https://jakevdp.github.io/blog/2017/03/22/group-by-from-scratch/&gt;`_.</span>
<span class="sd">    `&lt;http://esantorella.com/2016/06/16/groupby/&gt;`_.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    split-apply-combine .... that is the general rule</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">returned</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key_fld</span><span class="p">],</span>           <span class="c1"># the unique id field</span>
                         <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>    <span class="c1"># first occurrence index</span>
                         <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># indices needed to remake array</span>
                         <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   <span class="c1"># number in each group</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">returned</span>
<span class="c1">#    from_to = [[idx[i-1], idx[i]] for i in range(1, len(idx))]</span>
    <span class="n">from_to</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">cnt</span><span class="p">)))</span>
    <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">shp_flds</span><span class="p">][</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">from_to</span><span class="p">]</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">sub</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
              <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">subs</span> <span class="k">if</span> <span class="n">sub</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">groups</span></div>


<span class="c1"># ---- (6) analysis .... code section ----</span>
<span class="c1"># ---- uniq, is_in</span>
<span class="c1">#</span>
<div class="viewcode-block" id="uniq"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.uniq">[docs]</a><span class="k">def</span> <span class="nf">uniq</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">key_flds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">return_counts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Taken from, but modified for simple axis 0 and 1 and structured</span>
<span class="sd">    arrays in (N, m) or (N,) format.</span>

<span class="sd">    To enable determination of unique values in uniform arrays with</span>
<span class="sd">    uniform dtypes.  np.unique in versions &lt; 1.13 need to use this.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ar : array</span>
<span class="sd">        If this is a structured array, you can use `key_flds` to control</span>
<span class="sd">        how uniqueness is determined.</span>
<span class="sd">    key_flds : list or tuple</span>
<span class="sd">        Specify fields to slice the input array to determine uniqueness.</span>

<span class="sd">    The unique values are then used to return a slice of the input array.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    `&lt;https://github.com/numpy/numpy/blob/master/numpy/lib/arraysetops.py&gt;`_.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">key_flds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">a_slice</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="n">key_flds</span><span class="p">]</span>
        <span class="n">return_index</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">a_slice</span><span class="p">,</span> <span class="n">return_index</span><span class="p">,</span> <span class="n">return_inverse</span><span class="p">,</span>
                        <span class="n">return_counts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">out_arr</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">out_arr</span><span class="p">]</span>
        <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="k">return</span> <span class="n">values</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">return_index</span><span class="p">,</span> <span class="n">return_inverse</span><span class="p">,</span>
                     <span class="n">return_counts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>

<div class="viewcode-block" id="is_in"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.is_in">[docs]</a><span class="k">def</span> <span class="nf">is_in</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">look_for</span><span class="p">,</span> <span class="n">keep_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">not_in</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Similar to `np.isin` for numpy versions &lt; 1.13, but with additions to</span>
<span class="sd">    return the original shaped array with an `int` dtype</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr : array</span>
<span class="sd">        the array to check for the elements</span>
<span class="sd">    look_for : number, list or array</span>
<span class="sd">        what to use for the check</span>
<span class="sd">    keep_shape : boolean</span>
<span class="sd">        True, returns the array&#39;s original shape.  False, summarizes all axes</span>
<span class="sd">    not_in : boolean</span>
<span class="sd">        Switch the query look_for True</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    &gt;&gt;&gt; from numpy.lib import NumpyVersion</span>
<span class="sd">    &gt;&gt;&gt; if NumpyVersion(np.__version__) &lt; &#39;1.13.0&#39;):</span>
<span class="sd">        # can add for older versions later</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">shp</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">look_for</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">look_for</span><span class="p">)</span>
    <span class="n">uni</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">inv</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">not_in</span><span class="p">:</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">look_for</span><span class="p">,</span> <span class="n">assume_unique</span><span class="o">=</span><span class="n">uni</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="n">inv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">keep_shape</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">binary</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span></div>


<div class="viewcode-block" id="running_count"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.running_count">[docs]</a><span class="k">def</span> <span class="nf">running_count</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">to_label</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform a running count on a 1D array identifying the order number</span>
<span class="sd">    of the value in the sequence.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array</span>
<span class="sd">        1D array of values, int, float or string</span>
<span class="sd">    to_label : boolean</span>
<span class="sd">        Return the output as a concatenated string of value-sequence numbers if</span>
<span class="sd">        True, or if False, return a structured array with a specified dtype.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a = np.random.randint(1, 10, 10)</span>
<span class="sd">    &gt;&gt;&gt; #  [3, 5, 7, 5, 9, 2, 2, 2, 6, 4] #</span>
<span class="sd">    &gt;&gt;&gt; running_count(a, False)</span>
<span class="sd">    array([(3, 1), (5, 1), (7, 1), (5, 2), (9, 1), (2, 1), (2, 2),</span>
<span class="sd">           (2, 3), (6, 1), (4, 1)],</span>
<span class="sd">          dtype=[(&#39;Value&#39;, &#39;&lt;i4&#39;), (&#39;Count&#39;, &#39;&lt;i4&#39;)])</span>
<span class="sd">    &gt;&gt;&gt; running_count(a, True)</span>
<span class="sd">    array([&#39;3_001&#39;, &#39;5_001&#39;, &#39;7_001&#39;, &#39;5_002&#39;, &#39;9_001&#39;, &#39;2_001&#39;, &#39;2_002&#39;,</span>
<span class="sd">           &#39;2_003&#39;, &#39;6_001&#39;, &#39;4_001&#39;],</span>
<span class="sd">          dtype=&#39;&lt;U5&#39;)</span>

<span class="sd">    &gt;&gt;&gt; b = np.array(list(&quot;zabcaabbdedbz&quot;))</span>
<span class="sd">    &gt;&gt;&gt; #  [&#39;z&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;a&#39;, &#39;a&#39;, &#39;b&#39;, &#39;b&#39;, &#39;d&#39;, &#39;e&#39;, &#39;d&#39;,&#39;b&#39;, &#39;z&#39;] #</span>
<span class="sd">    &gt;&gt;&gt; running_count(b, False)</span>
<span class="sd">    array([(&#39;z&#39;, 1), (&#39;a&#39;, 1), (&#39;b&#39;, 1), (&#39;c&#39;, 1), (&#39;a&#39;, 2), (&#39;a&#39;, 3),</span>
<span class="sd">           (&#39;b&#39;, 2), (&#39;b&#39;, 3), (&#39;d&#39;, 1), (&#39;e&#39;, 1), (&#39;d&#39;, 2), (&#39;b&#39;, 4),</span>
<span class="sd">           (&#39;z&#39;, 2)], dtype=[(&#39;Value&#39;, &#39;&lt;U1&#39;), (&#39;Count&#39;, &#39;&lt;i4&#39;)])</span>
<span class="sd">    &gt;&gt;&gt; running_count(b, True)</span>
<span class="sd">    array([&#39;z_001&#39;, &#39;a_001&#39;, &#39;b_001&#39;, &#39;c_001&#39;, &#39;a_002&#39;, &#39;a_003&#39;, &#39;b_002&#39;,</span>
<span class="sd">           &#39;b_003&#39;, &#39;d_001&#39;, &#39;e_001&#39;, &#39;d_002&#39;, &#39;b_004&#39;, &#39;z_002&#39;], dtype=&#39;&lt;U5&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i4&#39;</span><span class="p">)]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># used for padding</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;mergesort&#39;</span><span class="p">)</span>
    <span class="n">s_a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">neq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">s_a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">s_a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">run</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">run</span><span class="p">[</span><span class="n">neq</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-=</span> <span class="n">neq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">run</span><span class="p">[</span><span class="n">neq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">neq</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="n">z</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">z</span><span class="p">[</span><span class="s1">&#39;Count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
    <span class="k">if</span> <span class="n">to_label</span><span class="p">:</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_{:0&gt;</span><span class="si">{}</span><span class="s2">}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">out</span><span class="p">))])</span>
    <span class="k">return</span> <span class="n">z</span></div>


<div class="viewcode-block" id="sequences"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.sequences">[docs]</a><span class="k">def</span> <span class="nf">sequences</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an array of sequence information denoted by stepsize.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array-like</span>
<span class="sd">        List/array of values in 1D</span>
<span class="sd">    stepsize : integer</span>
<span class="sd">        Separation between the values.</span>
<span class="sd">    If stepsize=0, sequences of equal values will be searched.  If stepsize</span>
<span class="sd">    is 1, then sequences incrementing by 1 etcetera.</span>
<span class="sd">    Stepsize can be both positive or negative::</span>

<span class="sd">        &gt;&gt;&gt; # check for incrementing sequence by 1&#39;s</span>
<span class="sd">        &gt;&gt;&gt; d = [1, 2, 3, 4, 4, 5]</span>
<span class="sd">        &gt;&gt;&gt; s = sequences(d, 1)</span>
<span class="sd">        |array([(0, 0, 4, 1, 4), (1, 4, 6, 4, 2)],</span>
<span class="sd">        |      dtype=[(&#39;ID&#39;, &#39;&lt;i4&#39;), (&#39;From_&#39;, &#39;&lt;i4&#39;), (&#39;To_&#39;, &#39;&lt;i4&#39;),</span>
<span class="sd">        |             (&#39;Value&#39;, &#39;&lt;i4&#39;), (&#39;Count&#39;, &#39;&lt;i4&#39;)])</span>
<span class="sd">        &gt;&gt;&gt; art.prn(s)</span>
<span class="sd">        id  ID    From_   To_   Value   Count</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        000     0       0     4       1       4</span>
<span class="sd">        001     1       4     6       4       2</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    For strings, use</span>

<span class="sd">    &gt;&gt;&gt; partitions = np.where(a[1:] != a[:-1])[0] + 1</span>

<span class="sd">    Change **N** in the expression to find other splits in the data</span>

<span class="sd">    &gt;&gt;&gt; np.split(data, np.where(np.abs(np.diff(data)) &gt;= N)[0]+1)</span>

<span class="sd">    Keep for now::</span>

<span class="sd">        checking sequences of 0, 1</span>
<span class="sd">        &gt;&gt;&gt; a = np.array([1,0,1,1,1,0,0,0,0,1,1,0,0])</span>
<span class="sd">        | np.hstack([[x.sum(), *[0]*(len(x) -1)]</span>
<span class="sd">        |           if x[0] == 1</span>
<span class="sd">        |           else x</span>
<span class="sd">        |           for x in np.split(a, np.where(np.diff(a) != 0)[0]+1)])</span>
<span class="sd">        &gt;&gt;&gt; # array([1, 0, 3, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0])</span>

<span class="sd">    References</span>
<span class="sd">    -----------</span>
<span class="sd">    `&lt;https://stackoverflow.com/questions/7352684/how-to-find-the-groups-of-</span>
<span class="sd">    sequences-elements-from-an-array-in-numpy&gt;`__.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">a_dt</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;From_&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;To_&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i4&#39;</span><span class="p">),</span>
          <span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i4&#39;</span><span class="p">),</span>
          <span class="p">]</span>
    <span class="k">if</span> <span class="n">a_dt</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">):</span>
        <span class="n">seqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">a_dt</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">):</span>
        <span class="n">seqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="n">stepsize</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seqs</span><span class="p">]</span>
    <span class="n">cnts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seqs</span><span class="p">]</span>
    <span class="n">seq_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cnts</span><span class="p">))</span>
    <span class="n">too</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">cnts</span><span class="p">)</span>
    <span class="n">frum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">too</span><span class="p">)</span>
    <span class="n">frum</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">too</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">seq_num</span><span class="p">,</span> <span class="n">frum</span><span class="p">,</span> <span class="n">too</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cnts</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<span class="c1"># ---- extras *****</span>

<div class="viewcode-block" id="pack_last_axis"><a class="viewcode-back" href="../../arraytools_mods.html#arraytools.tools.pack_last_axis">[docs]</a><span class="k">def</span> <span class="nf">pack_last_axis</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;used in nd2struct</span>
<span class="sd">    Then you could do:</span>
<span class="sd">    &gt;&gt;&gt; pack_last_axis(uv).tolist()</span>
<span class="sd">    to get a list of tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">names</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">&#39;f</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">view</span><span class="p">([(</span><span class="n">n</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># ---- _demo .... code section</span>
<span class="c1"># @run_deco</span>
<span class="k">def</span> <span class="nf">_demo_tools</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Run examples of the existing functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">nd2struct</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">bloc</span> <span class="o">=</span> <span class="n">block_arr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># for block</span>
    <span class="n">chng</span> <span class="o">=</span> <span class="n">change_arr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">prn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">scal</span> <span class="o">=</span> <span class="n">scale</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">m_blk</span> <span class="o">=</span> <span class="n">make_blocks</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
    <span class="n">m_fld</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">make_flds</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]))</span>
    <span class="n">spl</span> <span class="o">=</span> <span class="n">split_array</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">fld</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
    <span class="n">stri</span> <span class="o">=</span> <span class="n">stride</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">rsta</span> <span class="o">=</span> <span class="n">rolling_stats</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">no_null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#    arr = np.load(data_path + &#39;/sample_20.npy&#39;)</span>
<span class="c1">#    row = arr[&#39;County&#39;]</span>
<span class="c1">#    col = arr[&#39;Town&#39;]</span>
<span class="c1">#    ctab, a0, result, r0, c0 = crosstab(row, col)</span>
<span class="c1">#    arr = arr.reshape(arr.shape[0], -1)</span>
    <span class="n">frmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">: ----- _demo </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">:</span>
<span class="s2">:Input ndarray, &#39;a&#39; ...</span>
<span class="si">{!r:}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:Input ndarray, &#39;b&#39; ...</span>
<span class="si">{!r:}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:Input ndarray, &#39;c&#39; ...</span>
<span class="si">{!r:}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:Input ndarray, &#39;d&#39; ...</span>
<span class="si">{!r:}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:---- Functions by number  ---------------------------------------------</span>
<span class="s2">:(1)  arr2xyz(a, verbose=False)</span>
<span class="si">{}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:(2)  block_arr(a, win=[2, 2], nodata=-1)</span>
<span class="si">{}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:(3) change_arr(b, order=[&#39;B&#39;, &#39;C&#39;, &#39;A&#39;], prn=False</span>
<span class="s2">:    Array &#39;b&#39;, reordered with 2 fields dropped...</span>
<span class="si">{!r:}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:(5) scale() ... scale an array up by an integer factor...</span>
<span class="si">{}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:(7) make_flds() ... create default field names ...</span>
<span class="si">{}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:(8) split_array() ... split an array according to an index field</span>
<span class="si">{}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:(9) stride() ... stride an array ....</span>
<span class="si">{}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:(10) make_blocks(rows=3, cols=3, r=2, c=2, dt=&#39;int&#39;)</span>
<span class="si">{}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:(11) nd_struct() ... make a structured array from another array ...</span>
<span class="si">{!r:}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">:(12) rolling_stats()... stats for a strided array ...</span>
<span class="s2">:    min, max, mean, sum, std, var, ptp</span>
<span class="si">{}</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">62</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span>
            <span class="n">arr2xyz</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">bloc</span><span class="p">,</span> <span class="n">chng</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">scal</span><span class="p">,</span>  <span class="c1"># 1 -5</span>
            <span class="n">m_fld</span><span class="p">,</span> <span class="n">spl</span><span class="p">,</span> <span class="n">stri</span><span class="p">,</span> <span class="n">m_blk</span><span class="p">,</span> <span class="n">nd2struct</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">rsta</span><span class="p">]</span>  <span class="c1"># 6- 12</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">frmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
    <span class="c1"># del args, d, e</span>


<span class="k">def</span> <span class="nf">pyramid</span><span class="p">(</span><span class="n">core</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">incr</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">posi</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a pyramid see pyramid_demo.py&quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">core</span><span class="p">])</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">core</span> <span class="o">-</span> <span class="n">i</span>
        <span class="k">if</span> <span class="n">posi</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">incr</span><span class="p">,</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">a</span>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># ---- __main__ .... code section</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># print the script source name.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Script... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script</span><span class="p">))</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Dan Patterson

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>